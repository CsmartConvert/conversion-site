---
export const prerender = false;
import Layout from '../../layouts/Layout.astro';

let result = null;

if (Astro.request.method === 'POST') {
  const contentType = Astro.request.headers.get('content-type') || '';
  if (
    contentType.includes('application/x-www-form-urlencoded') ||
    contentType.includes('multipart/form-data')
  ) {
    const data = await Astro.request.formData();
    const priceA = parseFloat(data.get('priceA')) || 0;
    const quantityA = parseFloat(data.get('quantityA')) || 1;
    const priceB = parseFloat(data.get('priceB')) || 0;
    const quantityB = parseFloat(data.get('quantityB')) || 1;

    const unitPriceA = priceA / quantityA;
    const unitPriceB = priceB / quantityB;

    result = {
      unitPriceA,
      unitPriceB,
      betterDeal:
        unitPriceA < unitPriceB
          ? 'Option A is the better deal üí∞'
          : unitPriceB < unitPriceA
          ? 'Option B is the better deal üí∞'
          : 'Both options cost the same per unit ü§ù'
    };
  }
}
---

<Layout>
  <!-- üõí Header -->
  <section class="bg-gradient-to-r from-blue-600 to-blue-800 text-white py-6 px-4 md:py-8 mb-8 shadow text-center rounded-md max-w-3xl mx-auto">
    <h1 class="text-3xl font-bold mb-2">üõí Grocery Price Comparison</h1>
    <p class="text-base">Compare the unit price of two grocery items to see which is a better deal.</p>
  </section>

  <!-- üí° Tip Section -->
  <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-6 max-w-3xl mx-auto">
    <p class="text-blue-700">
      <strong>üí° Tip:</strong> Use this before buying bulk vs regular-sized products‚Äîit works great for cereal, snacks, and more.
    </p>
  </div>

  <!-- üßÆ Calculator Form -->
  <section class="bg-white border border-gray-200 p-6 rounded-lg shadow max-w-2xl mx-auto mb-10">
    <form method="POST" enctype="application/x-www-form-urlencoded" class="space-y-6">
      <div class="grid md:grid-cols-2 gap-6">
        <div>
          <label for="priceA" class="block font-medium text-gray-800">Option A Price ($):</label>
          <input type="number" step="any" name="priceA" id="priceA" class="w-full p-2 border rounded" required />
        </div>
        <div>
          <label for="quantityA" class="block font-medium text-gray-800">Option A Quantity (oz, ml, etc.):</label>
          <input type="number" step="any" name="quantityA" id="quantityA" class="w-full p-2 border rounded" required />
        </div>
        <div>
          <label for="priceB" class="block font-medium text-gray-800">Option B Price ($):</label>
          <input type="number" step="any" name="priceB" id="priceB" class="w-full p-2 border rounded" required />
        </div>
        <div>
          <label for="quantityB" class="block font-medium text-gray-800">Option B Quantity (oz, ml, etc.):</label>
          <input type="number" step="any" name="quantityB" id="quantityB" class="w-full p-2 border rounded" required />
        </div>
      </div>

      <button type="submit" class="bg-blue-700 hover:bg-blue-800 text-white py-2 px-4 rounded font-semibold w-full">
        Compare
      </button>
    </form>

    {result !== null && (
      <div class="mt-6 bg-green-50 border border-green-300 text-green-800 font-semibold p-4 rounded text-center">
        <p>üÖ∞Ô∏è Unit Price A: ${result.unitPriceA.toFixed(4)}</p>
        <p>üÖ±Ô∏è Unit Price B: ${result.unitPriceB.toFixed(4)}</p>
        <p class="mt-2">{result.betterDeal}</p>
      </div>
    )}
  </section>

  <!-- üìò Why This Matters + Pro Tips -->
  <section class="max-w-3xl mx-auto px-6 mt-6 mb-8">
    <h2 class="text-xl font-semibold mb-4 text-gray-800">Why This Matters</h2>
    <p class="text-gray-700 mb-4">
      Prices and sizes can be misleading on store shelves. Comparing unit prices helps you make smarter decisions and stretch your grocery budget further.
    </p>

    <h3 class="text-lg font-semibold mb-2 text-gray-800">Pro Tips</h3>
    <ul class="list-disc list-inside text-gray-700 space-y-1">
      <li>Don‚Äôt assume bulk is always cheaper‚Äîcalculate first.</li>
      <li>Use the same unit (oz, ml, g) when comparing quantity.</li>
      <li>Store-brand options often have better unit prices than name brands.</li>
    </ul>
  </section>
</Layout>

